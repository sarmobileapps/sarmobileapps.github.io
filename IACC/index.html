<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="refresh" content="3600">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>
        var fajrRawTime = null;
        var dhuhrRawTime = null;
        var asrRawTime = null;
        var maghribRawTime = null;
        var ishaRawTime = null;
        var playedAlready = false;
    </script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Verdana, sans-serif;
        }

        .mySlides {
            display: none;
        }

        img {
            vertical-align: middle;
        }

        /* Slideshow container */
        .slideshow-container {
            /* max-width: 1000px; */

            position: relative;
            margin: auto;
        }

        /* Caption text */
        .text {
            color: #f2f2f2;
            font-size: 15px;
            padding: 8px 12px;
            position: absolute;
            bottom: 8px;
            width: 100%;
            text-align: center;
        }

        /* Number text (1/3 etc) */
        .numbertext {
            color: #f2f2f2;
            font-size: 8px;
            padding: 8px 12px;
            position: absolute;
            top: 0;
        }

        /* The dots/bullets/indicators */
        .dot {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.6s ease;
        }

        .active {
            background-color: #717171;
        }

        /* Fading animation */
        .fade {
            animation-name: fade;
            animation-duration: 1.5s;
        }

        .timewidget {
            height: 20vh;
        }

        @keyframes fade {
            from {
                opacity: .4
            }

            to {
                opacity: 1
            }
        }

        /* On smaller screens, decrease text size */
        @media only screen and (max-width: 300px) {
            .text {
                font-size: 11px
            }
        }

        .float-container {
            padding: 2px;
        }

        .float-child-left {
            width: 75%;
            float: left;
            padding: 2px;
        }

        .float-child-right {
            width: 25%;
            float: right;
            padding: 2px;
        }

        .float-child-center {
            width: 50%;
            float: left;
            padding: 2px;
        }

        #boxframeprayer {
            width: 100%;
            background: #506A1B;
            direction: ltr;
            color: #FFFFFF;
            padding: 5px;
            font-family: Tahoma, Geneva, sans-serif;
            border-radius: 4px;
            box-sizing: border-box
        }

        #boxframeprayer img {
            border: 0
        }

        #boxframeprayer table {
            border: 0;
            width: 100%;
            border-collapse: collapse
        }

        #boxframeprayer table tr td {
            vertical-align: top;
            padding: 8px
        }

        #boxframeprayer table tr:first-child td img {
            height: 70px
        }

        #boxframeprayer table tr td .currentpray {
            font-size: 15px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, .63)
        }

        #boxframeprayer table tr td .thetimes {
            font-size: 12px;
            font-weight: normal;
            line-height: 16px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, .63)
        }

        #boxframeprayer table tr td .thetimes span:first-child {
            border-bottom: 1px solid #FFF
        }

        #boxframeprayer table tr td .datetime {
            font-size: 18px;
            font-weight: normal;
            line-height: 16px;
            text-align: left
        }

        #boxframeprayer table tr td .city {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, .63)
        }

        #boxframeprayer table tr td .country {
            font-size: 12px;
            font-weight: normal;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, .63)
        }

        #boxframeprayer table tr.headtdprayer td {
            font-size: 24px;
            text-align: center;
            background: #3a5405
        }

        #boxframeprayer table.tbllistprayer tr td {
            font-size: 28px;
            text-align: center;
            border-left: 0px solid #6E9226;
            border-right: 0px solid #6E9226;
            border-bottom: 1px solid #6E9226;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, .63)
        }

        .datetime {
            font-size: 20px;
        }

        .dateandtime {
            font-size: 24px;
        }

        .optiontr1 select {
            max-width: 100px
        }

        td.heightlithcolor {
            background: #3A4E13
        }

        #specialMsg {
            font-size: 35px;
            text-align: center;
            color: blue;
        }

        .prayerCountDownMsg1 {
            font-size: 40px;
            text-align: center;
            color: red;
        }
        .prayerCountDownMsg2 {
            font-size: 40px;
            text-align: center;
            color: red;
            animation: blinker 1s linear infinite;
        }

        @keyframes blinker {
            50% {
                opacity: 0;
            }
        }

        .highLight {
            background-color: yellow;
            color: red;
        }

    </style>
</head>

<body style="height: 100vh;">

    <div class="float-container">

        <div id="slideShowDiv" class="float-child-left">


            <div class="slideshow-container" style="width:100%;">

                <div class="mySlides fade">
                    <img src="images/Fundraising_Ramadan_2022_v2.002.jpeg" style="width:100%; height:90vh;">
                </div>

                <div class="mySlides fade">
                    <img src="images/Fundraising_Ramadan_2022_v2.003.jpeg" style="width:100%; height:90vh;">
                </div>

                <div class="mySlides fade">
                    <img src="images/Fundraising_Ramadan_2022_v2.004.jpeg" style="width:100%; height:90vh;">
                </div>

                <div class="mySlides fade">
                    <img src="images/Fundraising_Ramadan_2022_v2.005.jpeg" style="width:100%; height:90vh;">
                </div>

                <div class="mySlides fade">
                    <img src="images/Fundraising_Ramadan_2022_v2.006.jpeg" style="width:100%; height:90vh;">
                </div>

                <div class="mySlides fade">
                    <img src="images/Fundraising_Ramadan_2022_v2.007.jpeg" style="width:100%; height:90vh;">
                </div>

                <div class="mySlides fade">
                    <img src="images/Fundraising_Ramadan_2022_v2.008.jpeg" style="width:100%; height:90vh;">
                </div>
                
                <div class="mySlides fade">
                    <img src="images/IACC_Donation_Options.001.jpeg" style="width:100%; height:90vh;">
                </div>

                <div class="mySlides fade">
                    <img src="images/TurnOffCellphone1.jpeg" style="width:100%; height:90vh;">
                </div>

            </div>
            <br>

            <div style="text-align:center;">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
        </div>

        <div id="prayerTimesDiv" class="float-child-right">

                <div class="mypanel"></div>
                <div id="boxframeprayer">
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <img src="images/IACC_Logo_v2.jpeg"></td>
                                <td colspan="2" class="dateandtime">
                                    Current Time: <span id="datetime"></span>

                                        <script>
                                            function refreshTime() {
                                                const timeDisplay = document.getElementById("datetime");
                                                const dateString = new Date().toLocaleTimeString();
                                                timeDisplay.textContent = dateString;
                                                }
                                            setInterval(refreshTime, 1000);
                                        </script>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="city" id="city"></div>
                                </td>
                                <td colspan="2" class="dateandtime">
                                    <div id="dategregorian"></div>
                                    <div id="datehijri"></div>
                                    <div id="datehijri_ar"></div>
                                    <p></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="tbllistprayer" id="tblprayers">
                        <tbody>
                            <tr class="headtdprayer">
                                <td colspan="3" class="heightlithcolor">Prayer</td>
                                <td colspan="3" class="heightlithcolor">Adhan</td>
                                <td colspan="3" class="heightlithcolor">Iqama</td>
                            </tr>
                            <tr>
                                <td colspan="3" id="fajr">Fajr</td>
                                <td colspan="3" id="fajrtime"></td>
                                <td colspan="3" id="fajrtimeIqama"></td>
                            </tr>
                            <tr>
                                <td colspan="3" id="dhuhr">Dhuhr</td>
                                <td colspan="3" id="dhuhrtime"></td>
                                <td colspan="3" id="dhuhrtimeIqama"></td>
                            </tr>
                            <tr>
                                <td colspan="3" id="asr">Asr</td>
                                <td colspan="3" id="asrtime"></td>
                                <td colspan="3" id="asrtimeIqama"></td>
                            </tr>
                            <tr>
                                <td colspan="3" id="maghrib">Maghrib</td>
                                <td colspan="3" id="maghribtime"></td>
                                <td colspan="3" id="maghribtimeIqama"></td>
                            </tr>
                            <tr>
                                <td colspan="3" id="isha">Ishaa</td>
                                <td colspan="3" id="ishatime"></td>
                                <td colspan="3" id="ishatimeIqama"></td>
                            </tr>
                            <tr style="background-color: white;">
                                <td colspan="3"></td>
                                <td colspan="3"></td>
                                <td colspan="3"></td>
                            </tr>
                            <tr>
                                <td colspan="3">Jumuaa</td>
                                <td colspan="3">1:00 PM</td>
                                <td colspan="3"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div>
                    <h3 class="prayerCountDownMsg1" id="currentPrayer"></h3>
                    <h3 class="prayerCountDownMsg2" id="mins"></h3>
                </div>

                <div id="specialMsg">
                    <br>
                    
                </div>

            </div>
        </div>
    </div>

    <script>

        function getPrayerTimes() {
            var todayDate = new Date();
            var today = todayDate.getFullYear() + "-" + (todayDate.getMonth()+1) + "-" + todayDate.getDate();
            console.log("today is " + today);

            $.getJSON('https://api.aladhan.com/v1/timingsByCity?city=New-Britain&country=United%20States&method=2', function (data) {

                fajrRawTime = `${data.data.timings.Fajr}`;
                dhuhrRawTime = `${data.data.timings.Dhuhr}`;
                asrRawTime = `${data.data.timings.Asr}`;
                maghribRawTime = `${data.data.timings.Maghrib}`;
                ishaRawTime = `${data.data.timings.Isha}`;

                var fajr = tConvert(`${data.data.timings.Fajr}`);
                var dhuhr = tConvert(`${data.data.timings.Dhuhr}`);
                var asr = tConvert(`${data.data.timings.Asr}`);
                var maghrib = tConvert(`${data.data.timings.Maghrib}`);
                var isha = tConvert(`${data.data.timings.Isha}`);

                var fajrIqama = tConvert(addMinutes(`${data.data.timings.Fajr}`, 20));
                var dhuhrIqama = tConvert(addMinutes(`${data.data.timings.Dhuhr}`, 20));
                var asrIqama = tConvert(addMinutes(`${data.data.timings.Asr}`, 20));
                var maghribIqama = tConvert(addMinutes(`${data.data.timings.Maghrib}`, 10));
                var ishaIqama = tConvert(addMinutes(`${data.data.timings.Isha}`, 10));

                var city = 'New Britain'
                var dategregorian = `${data.data.date.gregorian.weekday.en + " " +
                    data.data.date.gregorian.month.en + " " +
                    data.data.date.gregorian.day + " " +
                    data.data.date.gregorian.year}`;
                var datehijri = `${data.data.date.hijri.month.en + " " +
                    data.data.date.hijri.day + " " +
                    data.data.date.hijri.year}`;
                var datehijri_ar = `${data.data.date.hijri.month.ar + " " +
                    data.data.date.hijri.day + " " +
                    data.data.date.hijri.year}`;

                $("#fajrtime").html(fajr);
                $("#dhuhrtime").html(dhuhr);
                $("#asrtime").html(asr);
                $("#maghribtime").html(maghrib);
                $("#ishatime").html(isha);

                $("#fajrtimeIqama").html(fajrIqama);
                $("#dhuhrtimeIqama").html(dhuhrIqama);
                $("#asrtimeIqama").html(asrIqama);
                $("#maghribtimeIqama").html(maghribIqama);
                $("#ishatimeIqama").html(ishaIqama);

                $("#city").html(city);
                $("#dategregorian").html(dategregorian);
                $("#datehijri").html(datehijri);
                $("#datehijri_ar").html(datehijri_ar);

                //countDownTimer();
                getCurrentPrayer();
            });
        }
        
        function tConvert (time) {
            // Check correct time format and split into components
            time = time.toString ().match (/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

            if (time.length > 1) { // If time format correct
                time = time.slice (1);  // Remove full string match value
                time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM
                time[0] = +time[0] % 12 || 12; // Adjust hours
            }
            return time.join (''); // return adjusted time or original string
        }

        function addMinutes(time, minsToAdd) {
            function D(J){ return (J<10? '0':'') + J;};
            var piece = time.split(':');
            var mins = piece[0]*60 + +piece[1] + +minsToAdd;

            return D(mins%(24*60)/60 | 0) + ':' + D(mins%60);  
        }
          
    </script>

    <script>
        let slideIndex = 0;
        showSlides();

        function showSlides() {
            let i;
            let slides = document.getElementsByClassName("mySlides");
            let dots = document.getElementsByClassName("dot");
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            slideIndex++;
            if (slideIndex > slides.length) { slideIndex = 1 }
            for (i = 0; i < dots.length; i++) {
                dots[i].className = dots[i].className.replace(" active", "");
            }
            slides[slideIndex - 1].style.display = "block";
            dots[slideIndex - 1].className += " active";
            setTimeout(showSlides, 11000); // Change image every 11 seconds
        }

    </script>

    <script>
        var now = new Date();
        var night = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate() + 1, // the next day, ...
            0, 0, 0 // ...at 00:00:00 hours
        );
        var msTillMidnight = night.getTime() - now.getTime();
        console.log("msTillMidnight: " + msTillMidnight);
        setTimeout('window.location = window.location.href', msTillMidnight);
    </script>

    <script>
        // The date/time we want to countdown to
       function countDownTimer(prayerIqama) { 
            //var countDownDate = new Date("Jul 25, 2022 16:37:52").getTime();
            //console.log("prayerIqama: " + prayerIqama);
            //var countDownDate = parseTime(fajrRawTime);
            var countDownDate = parseTime(prayerIqama);

            // Run myfunc every second
            var myfunc = setInterval(function() {

                var now = new Date().getTime();
                //now = new Date(now + 66*60000);  // ONLY ENABLE FOR TESTING
                var timeleft = countDownDate - now;
                    
                // Calculating the days, hours, minutes and seconds left
                //var days = Math.floor(timeleft / (1000 * 60 * 60 * 24));
                var hours = Math.floor((timeleft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((timeleft % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((timeleft % (1000 * 60)) / 1000);
                    
                // Result is output to the specific element
                document.getElementById("mins").innerHTML = "Iqama in: " + minutes + "m " + seconds + "s "
                document.getElementById("slideShowDiv").className = " float-child-center";
                document.getElementById("prayerTimesDiv").className = " float-child-center"
                
                // Display the message when countdown is over
                if (timeleft < 0) {
                    playedAlready = false;
                    clearInterval(myfunc);
                    document.getElementById("currentPrayer").innerHTML = "";
                    document.getElementById("mins").innerHTML = ""
                    document.getElementById("slideShowDiv").className = " float-child-left";
                    document.getElementById("prayerTimesDiv").className = " float-child-right"
                }
            }, 1000);
        }

        function getCurrentPrayer() {

            var intervalId = window.setInterval(function(){
                var now = new Date();
                //now = new Date(now.getTime() + 66*60000);  // ONLY ENABLE FOR TESTING

                var fajrBeginTime = parseTime(fajrRawTime);
                var fajrEndTime = new Date(fajrBeginTime.getTime() + 20*60000);
                // console.log("nowTime: " + now);
                // console.log("fajrBeginTime: " + fajrBeginTime);
                // console.log("fajrEndTime: " + fajrEndTime);
                // console.log(checkIfTimeIsInRange(now, fajrBeginTime, fajrEndTime));
                if (checkIfTimeIsInRange(now, fajrBeginTime, fajrEndTime)) {
                    countDownTimer(addZero(fajrEndTime.getHours()) + ":" + addZero(fajrEndTime.getMinutes()));
                    document.getElementById("currentPrayer").innerHTML = "It is time for Fajr";
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[1];
                    row.className = " highLight";
                    // Check if should play sound for begin adhan within the same 2 seconds
                    if (checkIfTimeIsInRange2(now, fajrBeginTime, new Date(fajrBeginTime.getTime() + 5000))) {
                        playWhenReady();
                    }
                } else {
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[1];
                    row.className = "";
                }

                var dhuhrBeginTime = parseTime(dhuhrRawTime);
                var dhuhrEndTime = new Date(dhuhrBeginTime.getTime() + 20*60000);
                // console.log("nowTime: " + now);
                // console.log("dhuhrBeginTime: " + dhuhrBeginTime);
                // console.log("dhuhrEndTime: " + dhuhrEndTime);
                // console.log(checkIfTimeIsInRange(now, dhuhrBeginTime, dhuhrEndTime));
                if (checkIfTimeIsInRange(now, dhuhrBeginTime, dhuhrEndTime) && now.getDay != 5) {
                    countDownTimer(addZero(dhuhrEndTime.getHours()) + ":" + addZero(dhuhrEndTime.getMinutes()));
                    document.getElementById("currentPrayer").innerHTML = "It is time for Dhuhr";
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[2];
                    row.className = " highLight";
                    // Check if should play sound for begin adhan within the same 2 seconds
                    if (checkIfTimeIsInRange2(now, dhuhrBeginTime, new Date(dhuhrBeginTime.getTime() + 5000))) {
                        playWhenReady();
                    }
                } else {
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[2];
                    row.className = "";
                }

                var asrBeginTime = parseTime(asrRawTime);
                var asrEndTime = new Date(asrBeginTime.getTime() + 20*60000);
                // console.log("nowTime: " + now);
                // console.log("asrBeginTime: " + asrBeginTime);
                // console.log("asrEndTime: " + asrEndTime);
                // console.log(checkIfTimeIsInRange(now, asrBeginTime, asrEndTime));
                if (checkIfTimeIsInRange(now, asrBeginTime, asrEndTime)) {
                    countDownTimer(addZero(asrEndTime.getHours()) + ":" + addZero(asrEndTime.getMinutes()));
                    document.getElementById("currentPrayer").innerHTML = "It is time for Asr";
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[3];
                    row.className = " highLight";
                    // Check if should play sound for begin adhan within the same 2 seconds
                    if (checkIfTimeIsInRange2(now, asrBeginTime, new Date(asrBeginTime.getTime() + 5000))) {
                        playWhenReady();
                    }
                } else {
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[3];
                    row.className = "";
                }

                var maghribBeginTime = parseTime(maghribRawTime);
                var maghribEndTime = new Date(maghribBeginTime.getTime() + 10*60000);
                // console.log("nowTime: " + now);
                // console.log("maghribBeginTime: " + maghribBeginTime);
                // console.log("maghribEndTime: " + maghribEndTime);
                // console.log(checkIfTimeIsInRange(now, maghribBeginTime, maghribEndTime));
                if (checkIfTimeIsInRange(now, maghribBeginTime, maghribEndTime)) {
                    countDownTimer(addZero(maghribEndTime.getHours()) + ":" + addZero(maghribEndTime.getMinutes()));
                    document.getElementById("currentPrayer").innerHTML = "It is time for Maghrib";
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[4];
                    row.className = " highLight";
                    // Check if should play sound for begin adhan within the same 2 seconds
                    if (checkIfTimeIsInRange2(now, maghribBeginTime, new Date(maghribBeginTime.getTime() + 5000))) {
                        playWhenReady();
                    }
                } else {
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[4];
                    row.className = "";
                }

                var ishaBeginTime = parseTime(ishaRawTime);
                var ishaEndTime = new Date(ishaBeginTime.getTime() + 10*60000);
                // console.log("nowTime: " + now);
                // console.log("ishaBeginTime: " + ishaBeginTime);
                // console.log("ishaEndTime: " + ishaEndTime);
                // console.log(checkIfTimeIsInRange(now, ishaBeginTime, ishaEndTime));
                if (checkIfTimeIsInRange(now, ishaBeginTime, ishaEndTime)) {
                    countDownTimer(addZero(ishaEndTime.getHours()) + ":" + addZero(ishaEndTime.getMinutes()));
                    document.getElementById("currentPrayer").innerHTML = "It is time for Ishaa";
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[5];
                    row.className = " highLight";
                    // Check if should play sound for begin adhan within the same 2 seconds
                    if (checkIfTimeIsInRange2(now, ishaBeginTime, new Date(ishaBeginTime.getTime() + 5000))) {
                        playWhenReady();
                    }                    
                } else {
                    var table = document.getElementById("tblprayers");
                    var row = table.rows[5];
                    row.className = "";
                }

            }, 3000);
        }

        function addZero(i) {
            if (i < 10) {i = "0" + i}
            return i;
        }

        const checkIfTimeIsInRange = (d, start, end) => {
            if (start.getHours() < d.getHours() && d.getHours() < end.getHours()) {
                return true;
            } else if (start.getHours() == d.getHours()) {
                if (d.getHours() == end.getHours()) {
                    if(start.getMinutes() <= d.getMinutes() && d.getMinutes() <= end.getMinutes()) {    
                        return true
                    } else {
                        return false
                    }
                } else if(start.getMinutes() <= d.getMinutes()) {
                    return true
                } else {
                    return false
                }
            } else if (d.getHours() == end.getHours()) {
                if(d.getMinutes() <= end.getMinutes()) {
                    return true
                } else {
                    return false
                }
            } else {
                return false
            }
        }

        const checkIfTimeIsInRange2 = (current, start, end) => {
            // console.log("current: " + current.getTime());
            // console.log("start: " + start.getTime());
            // console.log("end: " + end.getTime());
            if (start.getTime() <= current.getTime() && end.getTime() >= current.getTime()) {
                    return true;
            }
            return false;
        }

        function parseTime( t ) {
            var countDownDate = new Date(
                now.getFullYear(),
                now.getMonth(),
                now.getDate(), 
                00, 0, 0 // ...at 00:00:00 hours
            );
            var time = t.match( /(\d+)(?::(\d\d))?\s*(p?)/ );
            countDownDate.setHours( parseInt( time[1]) + (time[3] ? 12 : 0) );
            countDownDate.setMinutes( parseInt( time[2]) || 0 );
            return countDownDate;
        }

        // var delay = 5000; // in milliseconds, check every minute
        // var intervalId = setInterval("playWhenReady()", delay);

        function playWhenReady()
        {
            var d = new Date();
            var h = d.getHours();
            var m = d.getMinutes(); 

            //if (h === 17 && m === 00)
            //{
            if (!playedAlready) {
                playSound('./audio/going-up-186.mp3');
            }
                //clearInterval(intervalId);              
            //}
        }

        function playSound(soundFile)
        {
            var audioElement = document.createElement('audio');
            audioElement.setAttribute('src', soundFile);
            audioElement.setAttribute('muted', true);
            audioElement.play();
        }

        setTimeout(function() {
            location.reload();
        }, 3600000);  // refresh page every hour

        window.onload = getPrayerTimes();
    </script>
    

</body>

</html>
